chrome.runtime.sendMessage({},function(a){});var storage=chrome.storage.local;var href=window.location.href.split("?")[0].split("#")[0];var apis={delegateDoc:function(){$(document).on("change paste keyup input",':input[type!="radio"][type!="checkbox"]',function(c){console.log(c);var a=$(c.currentTarget);console.log(a.prop("tagName")+"->"+a.val());var b=a.calcXpath();console.log(b)}).on("click",'input[type="radio"], input[type="checkbox"]',function(c){console.log(c);var a=$(c.currentTarget);console.log(a.prop("tagName")+"->"+a.val());var b=a.calcXpath();console.log(b)}).on("click","a, span, em, i, s",function(c){console.log(c);var a=$(c.currentTarget);console.log(a.prop("tagName")+"->"+a.val());var b=a.calcXpath();console.log(b);storage.set({testNode:a})})},filterNodes:function(){var b=["input","textarea","select"];var d=$(b.join(",")).filter(":visible");var c=["button","file","hidden","image","reset","submit"];var a={};$.each(b,function(e,f){a[f]={}});d.each(function(l,o){var k=$(o);var f=k.prop("id");var e=k.prop("name");var h=k.prop("tagName").toLowerCase();var n=k.prop("type");var j=$.trim(k.val());if(h=="input"&&n&&($.inArray(n,c)==-1)){var i=a[h][n]||{};var m=(f&&("#"+f))||(e&&("input[name='"+e+"']"));if(n=="checkbox"){if(k.is(":checked")){if($.isEmptyObject(i[m])){var g=f?k:[k];i[m]=g}else{if(f){i[m]=k}else{i[m].push(k)}}}}else{if(n=="radio"){if(k.is(":checked")){var m="input[name='"+e+"']";i[m]=k}}else{if($.trim(k.val())!=""){i[m]=k}}}a[h][n]=i}else{if(f){a[h]["#"+f]=k}else{if(e){a[h][h+"[name='"+e+"']"]=k}}}});return a},transNodeToVal:function(b){var a=arguments.callee;$.each(b,function(c,d){if(!(d instanceof $)){a.call(this,d)}else{b[c]=$.trim(d.val())}});return b},transValToNode:function(b){var a=arguments.callee;$.each(b,function(c,h){var i=$.type(h);if(i==="string"||i==="array"){var d=$(c);if(d.length>0){var e=d.prop("tagName").toLowerCase();var f=d.prop("type");if(i==="string"){if(e=="input"){if(f=="radio"||f=="checkbox"){var g=d.filter(function(j){return $(this).val()==h});g.click()}else{d.focus().val(h).blur();apis.dispatch(d[0],"change")}}else{if(e=="select"){d.focus().val(h).blur();apis.dispatch(d[0],"change")}}}else{if(i==="array"){if(e=="input"&&f=="checkbox"){$.each(h,function(j,l){var k=d.filter(function(m){return $(this).val()==h});k.click()})}}}}}else{a.call(this,h)}})},dispatch:function(c,b){try{var a=document.createEvent("Event");a.initEvent(b,true,true);c.dispatchEvent(a)}catch(d){alert(d)}},snapshot:function(e){var c=apis.filterNodes();var a=apis.transNodeToVal(c);console.log(a);var b={};b[href]=a;storage.set(b);var d="成功创建快照！";e({msg:d})},recovery:function(b){var a="";storage.get(href,function(c){c=c[href];if(c){console.log(c);a="快照已成功恢复！"}else{a="对不起，当前页面尚未创建过快照！"}storage.get("click",function(e){e=e.click;console.log(e);var d=document.elementFromPoint(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset);console.log($(d));setTimeout(function(){d.focus()},10);b({msg:a});return a})});return a},autofill:function(c){var a={};var b="";storage.get("defaultOpts",function(d){if(d.defaultOpts){a=d.defaultOpts}$.each(a,function(f,e){$(f).each(function(g,h){h.value=e;apis.dispatch(h,"change")})});b="自动填充成功！";c({msg:b});return b});return b}};apis.delegateDoc();var defaultOpts={'input[type="text"]':"张三",'input[type="tel"]':"18012345678",'input[type="email"]':"test@taobao.com",'input[type="password"]':"Taobao1234",'input[type="date"]':"2013-09-26",'input[type="datetime-local"]':"2013-09-27T01:00",'input[type="time"]':"00:01",'input[type="month"]':"2013-09",'input[type="week"]':"2013-W38",'input[type="number"]':"31415926535",'input[type="color"]':"#FFFFFF",'input[type="url"]':"http://www.taobao.com",textarea:"淘宝测试淘宝测试淘宝测试淘宝测试"};storage.set({defaultOpts:defaultOpts});chrome.runtime.onMessage.addListener(function(c,b,a){apis[c.action].call(apis,a);return true});